---
import Layout from "@/layouts/Layout.astro";
import PostDetail from "@/components/posts/PostDetail.astro";
import { getAdjacentPosts, getPostEntries, parsePubDate } from "@/lib/post";
import type { Post } from "@/types";

export async function getStaticPaths() {
  const posts: Post[] = getPostEntries();

  return posts
    .filter((post) => Boolean(post.frontmatter.slug))
    .map((post) => ({
      params: { slug: post.frontmatter.slug },
      props: { post },
    }));
}

const { post } = Astro.props;
const {
  Content,
  frontmatter: { pubDate, title, summary },
} = post;
const tags = post.frontmatter.tags || [];
const tocHeadings = post
  .getHeadings()
  .filter(({ depth }) => depth >= 1 && depth <= 4);

const { prevPost, nextPost } = getAdjacentPosts(post.frontmatter.slug);
const parsedPubDate = parsePubDate(pubDate);
const navContext = "전체 글에서 이어보기";
---

<Layout>
  <PostDetail
    title={title}
    tags={tags}
    summary={summary}
    parsedPubDate={parsedPubDate}
    tocHeadings={tocHeadings}
    navContext={navContext}
    prevPost={prevPost}
    nextPost={nextPost}
    Content={Content}
  />
</Layout>
