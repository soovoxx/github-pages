---
title: "계산기 코드 파헤치기"
slug: "calculator-analysis"
pubDate: "2025-12-08"
summary: "계산기 코드 분석"
tags: ["react", "calculator"]
category: "react"
---

- Apple IPhone 의 계산기 Layout 처럼

- 저장소 코드
- [https://github.com/Jungsuu/react-calculator](https://github.com/Jungsuu/react-calculator)

## 1. 상태값

```ts
// 현재 화면에 표시되는 수식/입력 값
const [expression, setExpression] = useState<string>("0");
// 직전 결과를 저장하는 누산기
const [accumulator, setAccumulator] = useState<number | null>(null);
// 다음 연산에 사용할 연산자
const [operator, setOperator] = useState<Operator>(null);
// 다음 입력이 기존 값을 덮어쓸지 여부
const [overwrite, setOverwrite] = useState<boolean>(false);
```

## 2. 숫자키 눌렀을때의 이벤트 처리

```ts
const handleClick = (event: MouseEvent<HTMLButtonElement>) => {
	const value = event.currentTarget.dataset.value;

	if (!value) return;
	if (value === "." && !overwrite && expression.includes("."))
		return; // 현재 항목에 소수점 중복 입력 방지

	setExpression((prev) => {
		if (overwrite) {
			setOverwrite(false);
			return value === "." ? "0." : value;
		}
		return prev === "0" && value !== "." ? value : prev + value;
	});
};

...
<button type="button" data-value="1" onClick={handleClick}>1</button>

```

- 숫자관련한 버튼들은 아래의 `data-value` 속성으로 값이 지정되어 있어서 onClick 함수를 동작시킬때
  `event.currentTarget.dataset.value` 이렇게 값을 가져와야함

- 소수점을 찍는 버튼은 중복되어 찍히면 안되니, 문자열에 "." 이 포함된경우, 후처리를 못하도록 리턴처리를 하도록 하였음 `overwrite && expression.includes(".")`

- `overwrite(덮어쓰기유무)` 에 따라 처리를 다르게 분기처리 하였음

## 3. 다른 기능 버튼의 이벤트처리

```ts
// +/- 버튼: 현재 값 부호 뒤집기
const handleToggle = () => {
  if (!expression) return;
  const v = parseFloat(expression) * -1;
  setExpression(v.toString());
};

// Del 버튼: 마지막 자리 삭제
const handleDelete = () => {
  setExpression((prev) => (prev.length > 1 ? prev.slice(0, -1) : "0"));
};

// AC 버튼: 모든 상태 초기화
const handleReset = () => {
  setExpression("0");
  setAccumulator(null);
  setOperator(null);
  setOverwrite(false);
};

// % 버튼: 현재 값을 백분율로 변환
const handlePercent = () => {
  if (!expression) return;
  const v = parseFloat(expression) / 100;
  setExpression(v.toString());
};
```

- `handleToggle()` 이벤트는 `+/-` 버튼을 누를때 음수 <-> 양수 전환을 시켜주는 함수, 따라서 값을 문자열에서 숫자로 변경후, 다시 문자열로 변경시켜주는 역할을 함

- `handleDelete()` 이벤트는 계산기의 뒤로가기(끝의 숫자 지우기)를 진행한다, 만약 마지막 숫자(1자리)를 지울경우 0으로 리셋시켜줌

- `handleReset()` 이벤트는 계산기의 AC 와 같은 기능을 하도록 만들어졌다, (상태도 계산기의 초기상태) 초기화 처리를 하도록 설계되어있음

- `handlePercent` 이벤트는 계산기의 값이 입력되었을때 백분율로 변환해주는 함수이다,
  `ex) 75 입력후 % 버튼을 누르면 0.75가 출력`

## 4. 사칙연산 버튼 눌렀을때,

```ts
// 사칙연산 및 결과 계산 처리
const handleCalc = (event: MouseEvent<HTMLButtonElement>) => {
  const exp = event.currentTarget.dataset.exp;

  // 누산기와 현재 값으로 연산 실행
  const performOperation = (
    op: Exclude<Operator, null>,
    left: number,
    right: number
  ) => {
    switch (op) {
      case "add":
        return left + right;
      case "sub":
        return left - right;
      case "mul":
        return left * right;
      case "div":
        return right === 0 ? Number.NaN : left / right;
    }
  };

  const currentValue = parseFloat(expression);

  switch (exp) {
    case "add":
    case "sub":
    case "mul":
    case "div": {

      if (Number.isNaN(currentValue)) return;

      if (accumulator === null) {
        setAccumulator(currentValue);
      } else if (operator) {
        const nextValue = performOperation(operator, accumulator, currentValue);
        if (Number.isNaN(nextValue)) {
          setExpression("Error");
          setAccumulator(null);
          setOperator(null);
          setOverwrite(true);
          break;
        }
        setAccumulator(nextValue);
        setExpression(nextValue.toString());
      }

      setOperator(exp as Operator);
      setOverwrite(true);
      break;
    }
    case "result": {
      if (
        operator === null ||
        accumulator === null ||
        Number.isNaN(currentValue)
      )
        return;
      const nextValue = performOperation(operator, accumulator, currentValue);
      if (Number.isNaN(nextValue)) {
        setExpression("Error");
        setAccumulator(null);
        setOperator(null);
        setOverwrite(true);
        break;
      }
      setExpression(nextValue.toString());
      setAccumulator(null);
      setOperator(null);
      setOverwrite(true);
      break;
    }
    default:
      break;
  }
};

... (html)
<button type="button" data-exp="add" onClick={handleCalc}> + </button>
```

- 사칙연산 연산기호 `data-exp` 기호는 아니고, string 값이지만, 이값으로 연산자를 매칭하여, 계산을 유도(`switch 문을 이용`) 한다,

- `accumulator` 값이 없으면, 현재 계산기에 입력된값 `expression` 을 저장하고, 입력된 연산자 에 따라서 값을 `누적` 시키는것이 **포인트**

- `=` 버튼을 누르면, 누산된 값을 `expression` 에 보여주도록 하고, 보여주면서 나머지 상태값은 초기화 처리하는것이 포인트
