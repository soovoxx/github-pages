---
export interface Props {
  src: string | ImageMetadata;
  alt?: string;
  width?: number | string;
  height?: number | string;
}

const { src, alt = "", width, height } = Astro.props as Props;

const toCssSize = (value?: number | string) => {
  if (value === undefined || value === null || value === "") return undefined;
  return typeof value === "number" ? `${value}px` : value;
};

const resolvedSrc = typeof src === "string" ? src : src.src;
const resolvedWidth =
  width === undefined && typeof src !== "string" ? src.width : width;
const resolvedHeight =
  height === undefined && typeof src !== "string" ? src.height : height;

const widthStyle = toCssSize(resolvedWidth);
const heightStyle = toCssSize(resolvedHeight);
const widthAttr = typeof resolvedWidth === "number" ? resolvedWidth : undefined;
const heightAttr =
  typeof resolvedHeight === "number" ? resolvedHeight : undefined;

const imgStyle = [
  "display: block",
  "max-width: 100%",
  "height: auto",
  widthStyle ? `width: ${widthStyle}` : "",
  heightStyle ? `height: ${heightStyle}` : "",
]
  .filter(Boolean)
  .join("; ");
---

<figure class="mdx-image">
  <img
    src={resolvedSrc}
    alt={alt}
    width={widthAttr}
    height={heightAttr}
    loading="lazy"
    style={imgStyle}
  />
</figure>

<style>
  .mdx-image {
    max-width: 800px;
    margin: 12px auto;
  }
</style>
