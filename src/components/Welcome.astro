---
import { BLOG_NAME } from "../constants";
import type { Post } from "../types";
import Front from "./Front.astro";

const postEntries: Post[] = Object.values(import.meta.glob('../post/*.md', { eager: true }));

const posts = postEntries
  .map((post) => ({
    title: post.frontmatter.title,
    summary: post.frontmatter.summary,
    date: new Date(post.frontmatter.pubDate),
    slug: post.frontmatter.slug,
  }))
  .filter((post) => Boolean(post.slug))
  .sort((a, b) => Number(b.date) - Number(a.date));

const limitedPosts = posts.slice(0, 10);

const baseUrl = import.meta.env.BASE_URL?.replace(/\/$/, '') || '';
const postUrl = `${baseUrl}/posts`;
const aboutUrl = `${baseUrl}/about`;
---
<section class="hero" id="title">
  <div class="hero-graphic">
    <div class="planet">
      <span class="ring"></span>
      <span class="sparkle"></span>
    </div>
    <p class="whisper">Dreamy little blog</p>
  </div>
  <div class="hero-copy">
    <p class="eyebrow">{BLOG_NAME}</p>
    <h1>Small notes for my future self.</h1>
    <p class="lede">매일 배운 것들을, 나중에 다시 꺼내볼 수 있게 기록합니다.
개발하면서 부딪힌 문제, 풀어낸 방법, 그리고 사이사이의 일상까지 남겨요.</p>
  </div>
</section>

<!-- Reordered sections: Posts first, then About -->

<section class="section posts" id="posts">
  <div class="section-heading">
    <h2>Posts</h2>
    <p>가볍게 읽을 수 있는 최근 글 목록을 준비했어요.</p>
    <Front text="더 많은 글 보기" link={postUrl} />
  </div>
  <div class="post-grid">
    {limitedPosts.length === 0 ? (
      <p class="empty">등록된 글이 아직 없어요.</p>
    ) : (
      limitedPosts.map((post) => (
        <a class="post-card" href={`${baseUrl}/${post.slug}`}>
          <div class="post-visual"></div>
          <div class="post-meta">
            <p class="post-title">{post.title}</p>
            <p class="post-summary">{post.summary}</p>
          </div>
        </a>
      ))
    )}
  </div>
</section>

<section class="section about" id="about">
  <div class="section-heading">
    <h2>About</h2>
    <p>이곳은 배움과 개발 여정을 기록하는 공간입니다.</p>
  </div>
  <div class="about-body">
    <p>
      하루 동안 배운 것, 프로젝트하면서 고민했던 점들을 가볍게 기록해요.
      디테일한 소개와 스택, 이력은 About 페이지에 정리해 두었습니다.
    </p>
    <Front text="더 자세히 보기" link={aboutUrl} />
  </div>
</section>
<style>
  .hero {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 32px;
    align-items: center;
    padding: 32px;
    background: color-mix(in srgb, var(--panel) 88%, transparent);
    border-radius: 28px;
    border: 1px solid color-mix(in srgb, var(--text) 10%, transparent);
    box-shadow: 0 20px 50px var(--shadow);
  }

  .hero-graphic {
    display: grid;
    gap: 12px;
    justify-items: center;
  }

  .planet {
    position: relative;
    width: 180px;
    aspect-ratio: 1;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #f5edff 0%, #c5b7ff 45%, #9d83f8 90%);
    box-shadow: 0 16px 40px var(--shadow);
    overflow: hidden;
  }

  .ring {
    position: absolute;
    inset: 42% -18% auto -18%;
    height: 40px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0));
    border-radius: 50%;
    transform: rotate(-12deg);
    filter: blur(1px);
  }

  .sparkle {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #fbf8ff;
    top: 18%;
    right: 16%;
    border-radius: 4px;
    transform: rotate(20deg);
    box-shadow:
      -30px 40px 0 2px rgba(251, 248, 255, 0.9),
      24px 70px 0 2px rgba(251, 248, 255, 0.7);
  }

  .whisper {
    color: var(--muted);
    font-weight: 600;
    letter-spacing: 0.02em;
  }

  .hero-copy {
    display: grid;
    gap: 12px;
  }

  .eyebrow {
    font-size: 0.95rem;
    font-weight: 700;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--muted);
    margin: 0;
  }

  h1 {
    font-size: clamp(1.8rem, 3vw, 2.4rem);
    margin: 0;
  }

  .lede {
    color: var(--muted);
    line-height: 1.6;
    margin: 0;
  }

  .pill.ghost {
    background: var(--panel);
    color: var(--text);
  }

  .section {
    margin-top: 64px;
    background: color-mix(in srgb, var(--panel) 88%, transparent);
    border-radius: 28px;
    padding: 32px;
    border: 1px solid color-mix(in srgb, var(--text) 10%, transparent);
    box-shadow: 0 18px 40px var(--shadow);
  }

  .section-heading {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: baseline;
    flex-wrap: wrap;
    margin-bottom: 18px;
  }

  .section-heading h2 {
    margin: 0;
    font-size: 1.6rem;
  }

  .section-heading p {
    margin: 0;
    color: var(--muted);
  }

  .about-body {
    display: grid;
    gap: 14px;
    color: var(--text);
    line-height: 1.65;
  }

  .posts .section-heading {
    margin-bottom: 24px;
  }

  .post-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 18px;
  }

  .empty {
    grid-column: 1 / -1;
    margin: 0;
    color: var(--muted);
  }

  .post-card {
    display: grid;
    gap: 12px;
    padding: 14px;
    border-radius: 20px;
    background: var(--panel);
    text-decoration: none;
    color: var(--text);
    border: 1px solid color-mix(in srgb, var(--text) 8%, transparent);
    box-shadow: 0 12px 28px var(--shadow);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
  }

  .post-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 16px 32px var(--shadow);
  }

  .post-visual {
    height: 120px;
    border-radius: 14px;
    background: linear-gradient(135deg, #ffe3f3, #f7c8ff, #f6a6d7);
    position: relative;
    overflow: hidden;
  }

  .post-visual::after {
    content: '';
    position: absolute;
    inset: 14px;
    border-radius: 12px;
    background: linear-gradient(120deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));
    transform: rotate(-6deg);
  }

  .post-title {
    margin: 0;
    font-weight: 800;
    font-size: 1.05rem;
  }

  .post-excerpt {
    margin: 0;
    color: var(--muted);
    line-height: 1.5;
  }

  @media (max-width: 960px) {
    .hero {
      grid-template-columns: 1fr;
    }

    .hero-graphic {
      order: 2;
    }
  }

  @media (max-width: 640px) {
    .post-grid {
      grid-template-columns: 1fr;
    }

    .hero,
    .section {
      padding: 22px;
    }

    .section-heading {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
